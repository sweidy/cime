<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4. Design Details &mdash; CIME with documentation about the Replay cime5.6.replay documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5d88beb4"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/pop_ver.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. Data Model Science" href="data-model-science.html" />
    <link rel="prev" title="3. Input Streams" href="input-streams.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CIME with documentation about the Replay
          </a>
              <div class="version">
                cime5.6.replay
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../what_cime/index.html">What is CIME?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/index.html">Case Control System Part 1: Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users_guide/index.html#case-control-system-part-2-configuration-porting-testing-and-use-cases">Case Control System Part 2: Configuration, Porting, Testing and Use Cases</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Data Models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="input-namelists.html">2. Input Namelists</a></li>
<li class="toctree-l2"><a class="reference internal" href="input-streams.html">3. Input Streams</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4. Design Details</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-model-performance">4.1. Data Model Performance</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-model-limitations">4.2. Data Model Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#io-through-data-models">4.3. IO Through Data Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restart-files">4.4. Restart Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-structures">4.5. Data Structures</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="data-model-science.html">5. Data Model Science</a></li>
<li class="toctree-l2"><a class="reference internal" href="data-atm.html">6. Data Atmosphere (DATM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="data-lnd.html">7. Data Land (DLND)</a></li>
<li class="toctree-l2"><a class="reference internal" href="data-seaice.html">8. Data Ice (DICE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="data-ocean.html">9. Data Ocean (DOCN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="data-river.html">10. Data River (DROF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="data-wave.html">11. Data Wave (DWAV)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../driver_cpl/index.html">Driver/Coupler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_cpl/index.html">Building a Coupled Model with CIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc_tools/index.html">Miscellaneous Tools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../glossary/index.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools_user/index.html">User Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xml_files/index.html">XML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CIME_api/modules.html">CIME</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools_api/modules.html">Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CIME with documentation about the Replay</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Data Models</a></li>
      <li class="breadcrumb-item active"><span class="section-number">4. </span>Design Details</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/data_models/design-details.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="design-details">
<span id="id1"></span><h1><span class="section-number">4. </span>Design Details<a class="headerlink" href="#design-details" title="Link to this heading"></a></h1>
<section id="data-model-performance">
<h2><span class="section-number">4.1. </span>Data Model Performance<a class="headerlink" href="#data-model-performance" title="Link to this heading"></a></h2>
<p>There are two primary costs associated with strdata: reading data and spatially mapping data.
Time interpolation is relatively cheap in the current implementation.
As much as possible, redundant operations are minimized.
Fill and mapping weights are generated at initialization and saved.
The upper and lower bound mapped input data is saved between time steps to reduce mapping costs in cases where data is time interpolated more often than new data is read.
If the input data timestep is relatively small (for example, hourly data as opposed to daily or monthly data) the cost of reading input data can be quite large.
Also, there can be significant variation in cost of the data model over the coarse of the run, for instance, when new inputdata must be read and interpolated, although it’s relatively predictable.
The present implementation doesn’t support changing the order of operations, for instance, time interpolating the data before spatial mapping.
Because the present computations are always linear, changing the order of operations will not fundamentally change the results.
The present order of operations generally minimizes the mapping cost for typical data model use cases.</p>
</section>
<section id="data-model-limitations">
<h2><span class="section-number">4.2. </span>Data Model Limitations<a class="headerlink" href="#data-model-limitations" title="Link to this heading"></a></h2>
<p>There are several limitations in both options and usage within the data models at the present time.
Spatial interpolation can only be performed from a two-dimensional latitude-longitude input grid.
The target grid can be arbitrary but the source grid must be able to be described by simple one-dimensional lists of longitudes and latitudes, although they don’t have to be equally spaced.</p>
</section>
<section id="io-through-data-models">
<h2><span class="section-number">4.3. </span>IO Through Data Models<a class="headerlink" href="#io-through-data-models" title="Link to this heading"></a></h2>
<p>At the present time, data models can only read netcdf data, and IO is handled through either standard netcdf interfaces or through the PIO library using either netcdf or pnetcdf.
If standard netcdf is used, global fields are read and then scattered one field at a time.
If PIO is used, then data will be read either serially or in parallel in chunks that are approximately the global field size divided by the number of IO tasks.
If pnetcdf is used through PIO, then the pnetcdf library must be included during the build of the model.
The pnetcdf path and option is hardwired into the <code class="docutils literal notranslate"><span class="pre">Macros.make</span></code> file for the specific machine.
To turn on <code class="docutils literal notranslate"><span class="pre">pnetcdf</span></code> in the build, make sure the <code class="docutils literal notranslate"><span class="pre">Macros.make</span></code> variables <code class="docutils literal notranslate"><span class="pre">PNETCDF_PATH</span></code>, <code class="docutils literal notranslate"><span class="pre">INC_PNETCDF</span></code>, and <code class="docutils literal notranslate"><span class="pre">LIB_PNETCDF</span></code> are set and that the PIO <code class="docutils literal notranslate"><span class="pre">CONFIG_ARGS</span></code> sets the <code class="docutils literal notranslate"><span class="pre">PNETCDF_PATH</span></code> argument.</p>
<p>Beyond just the option of selecting IO with PIO, several namelist variables are available to help optimize PIO IO performance.
Those are <strong>TODO</strong> - list these.
The total mpi tasks that can be used for IO is limited to the total number of tasks used by the data model.
Often though, using fewer IO tasks results in improved performance.
In general, [io_root + (num_iotasks-1)*io_stride + 1] has to be less than the total number of data model tasks.
In practice, PIO seems to perform optimally somewhere between the extremes of 1 task and all tasks, and is highly machine and problem dependent.</p>
</section>
<section id="restart-files">
<h2><span class="section-number">4.4. </span>Restart Files<a class="headerlink" href="#restart-files" title="Link to this heading"></a></h2>
<p>Restart files are generated automatically by the data models based on a flag sent from the driver.
The restart files must meet the CIME naming convention and an <code class="docutils literal notranslate"><span class="pre">rpointer</span></code> file is generated at the same time.
An <code class="docutils literal notranslate"><span class="pre">rpointer</span></code> file is a <em>restart pointer</em> file which contains the name of the most recently created restart file.
Normally, if restart files are read, the restart filenames are specified in the <code class="docutils literal notranslate"><span class="pre">rpointer</span></code> file.
Optionally though, there are namelist variables such as <code class="docutils literal notranslate"><span class="pre">restfilm</span></code> to specify the restart filenames via namelist. If those namelist variables are set, the <code class="docutils literal notranslate"><span class="pre">rpointer</span></code> file will be ignored.</p>
<p>In most cases, no restart file is required for the data models to restart exactly.
This is because there is no memory between timesteps in many of the data model science modes.
If a restart file is required, it will be written automatically and then must be used to continue the previous run.</p>
<p>There are separate stream restart files that only exist for performance reasons.
A stream restart file contains information about the time axis of the input streams.
This information helps reduce the startup costs associated with reading the input dataset time axis information.
If a stream restart file is missing, the code will restart without it but may need to reread data from the input data files that would have been stored in the stream restart file.
This will take extra time but will not impact the results.</p>
</section>
<section id="data-structures">
<span id="id2"></span><h2><span class="section-number">4.5. </span>Data Structures<a class="headerlink" href="#data-structures" title="Link to this heading"></a></h2>
<p>The data models all use three fundamental routines.</p>
<ul class="simple">
<li><p>$CIMEROOT/src/utils/shr_dmodel_mod.F90</p></li>
<li><p>$CIMEROOT/src/utils/shr_stream_mod.F90</p></li>
<li><p>$CIMEROOT/src/utils/shr_strdata.F90</p></li>
</ul>
<p>These routines contain three data structures that are leveraged by all the data model code.</p>
<p>The most basic type, <code class="docutils literal notranslate"><span class="pre">shr_stream_fileType</span></code> is contained in <code class="docutils literal notranslate"><span class="pre">shr_stream_mod.F90</span></code> and specifies basic information related to a given stream file.</p>
<div class="highlight-Fortran notranslate"><div class="highlight"><pre><span></span><span class="k">type </span><span class="n">shr_stream_fileType</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CL</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shr_stream_file_null</span><span class="w">     </span><span class="c">! the file name</span>
<span class="w">   </span><span class="kt">logical</span><span class="w">                </span><span class="kd">::</span><span class="w"> </span><span class="n">haveData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w">              </span><span class="c">! has t-coord data been read in?</span>
<span class="w">   </span><span class="kt">integer</span><span class="w">  </span><span class="p">(</span><span class="n">SHR_KIND_IN</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">                          </span><span class="c">! size of time dimension</span>
<span class="w">   </span><span class="kt">integer</span><span class="w">  </span><span class="p">(</span><span class="n">SHR_KIND_IN</span><span class="p">),</span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">date</span><span class="p">(:)</span><span class="w">             </span><span class="c">! t-coord date: yyyymmdd</span>
<span class="w">   </span><span class="kt">integer</span><span class="w">  </span><span class="p">(</span><span class="n">SHR_KIND_IN</span><span class="p">),</span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">secs</span><span class="p">(:)</span><span class="w">             </span><span class="c">! t-coord secs: elapsed on date</span>
<span class="k">end type </span><span class="n">shr_stream_fileType</span>
</pre></div>
</div>
<p>The following type, <code class="docutils literal notranslate"><span class="pre">shr_stream_streamType</span></code> contains information
that encapsulates the information related to all files specific to a
target stream. These are the list of files found in the <code class="docutils literal notranslate"><span class="pre">domainInfo</span></code>
and <code class="docutils literal notranslate"><span class="pre">fieldInfo</span></code> blocks of the target stream description file (see the overview of the <a class="reference internal" href="input-streams.html#stream-description-file"><span class="std std-ref">Stream Description File</span></a>).</p>
<div class="highlight-Fortran notranslate"><div class="highlight"><pre><span></span><span class="k">type </span><span class="n">shr_stream_streamType</span>
<span class="w">   </span><span class="c">!private                                    ! no public access to internal components</span>
<span class="w">   </span><span class="c">!--- input data file names and data ---</span>
<span class="w">   </span><span class="kt">logical</span><span class="w">                   </span><span class="kd">::</span><span class="w"> </span><span class="n">init</span><span class="w">           </span><span class="c">! has stream been initialized?</span>
<span class="w">   </span><span class="kt">integer</span><span class="w">  </span><span class="p">(</span><span class="n">SHR_KIND_IN</span><span class="p">),</span><span class="k">pointer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">initarr</span><span class="p">(:)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">null</span><span class="p">()</span><span class="c">! surrogate for init flag</span>
<span class="w">   </span><span class="kt">integer</span><span class="w">  </span><span class="p">(</span><span class="n">SHR_KIND_IN</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">nFiles</span><span class="w">         </span><span class="c">! number of data files</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CS</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">dataSource</span><span class="w">     </span><span class="c">! meta data identifying data source</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CL</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">filePath</span><span class="w">       </span><span class="c">! remote location of data files</span>
<span class="w">   </span><span class="k">type</span><span class="p">(</span><span class="n">shr_stream_fileType</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="k">file</span><span class="p">(:)</span><span class="w"> </span><span class="c">! data specific to each file</span>

<span class="w">   </span><span class="c">!--- specifies how model dates align with data dates ---</span>
<span class="w">   </span><span class="kt">integer</span><span class="p">(</span><span class="n">SHR_KIND_IN</span><span class="p">)</span><span class="w">      </span><span class="kd">::</span><span class="w"> </span><span class="n">yearFirst</span><span class="w">      </span><span class="c">! first year to use in t-axis (yyyymmdd)</span>
<span class="w">   </span><span class="kt">integer</span><span class="p">(</span><span class="n">SHR_KIND_IN</span><span class="p">)</span><span class="w">      </span><span class="kd">::</span><span class="w"> </span><span class="n">yearLast</span><span class="w">       </span><span class="c">! last  year to use in t-axis (yyyymmdd)</span>
<span class="w">   </span><span class="kt">integer</span><span class="p">(</span><span class="n">SHR_KIND_IN</span><span class="p">)</span><span class="w">      </span><span class="kd">::</span><span class="w"> </span><span class="n">yearAlign</span><span class="w">      </span><span class="c">! align yearFirst with this model year</span>
<span class="w">   </span><span class="kt">integer</span><span class="p">(</span><span class="n">SHR_KIND_IN</span><span class="p">)</span><span class="w">      </span><span class="kd">::</span><span class="w"> </span><span class="n">offset</span><span class="w">         </span><span class="c">! offset in seconds of stream data</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CS</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">taxMode</span><span class="w">        </span><span class="c">! cycling option for time axis</span>

<span class="w">   </span><span class="c">!--- useful for quicker searching ---</span>
<span class="w">   </span><span class="kt">integer</span><span class="p">(</span><span class="n">SHR_KIND_IN</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">k_lvd</span><span class="p">,</span><span class="n">n_lvd</span><span class="w">         </span><span class="c">! file/sample of least valid date</span>
<span class="w">   </span><span class="kt">logical</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">found_lvd</span><span class="w">           </span><span class="c">! T &lt;=&gt; k_lvd,n_lvd have been set</span>
<span class="w">   </span><span class="kt">integer</span><span class="p">(</span><span class="n">SHR_KIND_IN</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">k_gvd</span><span class="p">,</span><span class="n">n_gvd</span><span class="w">         </span><span class="c">! file/sample of greatest valid date</span>
<span class="w">   </span><span class="kt">logical</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">found_gvd</span><span class="w">           </span><span class="c">! T &lt;=&gt; k_gvd,n_gvd have been set</span>

<span class="w">   </span><span class="c">!---- for keeping files open</span>
<span class="w">   </span><span class="kt">logical</span><span class="w">                 </span><span class="kd">::</span><span class="w"> </span><span class="n">fileopen</span><span class="w">         </span><span class="c">! is current file open</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CL</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">currfile</span><span class="w">         </span><span class="c">! current filename</span>
<span class="w">   </span><span class="k">type</span><span class="p">(</span><span class="n">file_desc_t</span><span class="p">)</span><span class="w">       </span><span class="kd">::</span><span class="w"> </span><span class="n">currpioid</span><span class="w">        </span><span class="c">! current pio file desc</span>

<span class="w">   </span><span class="c">!--- stream data not used by stream module itself ---</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CXX</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="n">fldListFile</span><span class="w">       </span><span class="c">! field list: file&#39;s  field names</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CXX</span><span class="p">)</span><span class="kd">::</span><span class="w"> </span><span class="n">fldListModel</span><span class="w">      </span><span class="c">! field list: model&#39;s field names</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CL</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">domFilePath</span><span class="w">       </span><span class="c">! domain file: file path of domain file</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CL</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">domFileName</span><span class="w">       </span><span class="c">! domain file: name</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CS</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">domTvarName</span><span class="w">       </span><span class="c">! domain file: time-dim var name</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CS</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">domXvarName</span><span class="w">       </span><span class="c">! domain file: x-dim var name</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CS</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">domYvarName</span><span class="w">       </span><span class="c">! domain file: y-dim var name</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CS</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">domZvarName</span><span class="w">       </span><span class="c">! domain file: z-dim var name</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CS</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">domAreaName</span><span class="w">       </span><span class="c">! domain file: area  var name</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CS</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">domMaskName</span><span class="w">       </span><span class="c">! domain file: mask  var name</span>

<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CS</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tInterpAlgo</span><span class="w">       </span><span class="c">! Algorithm to use for time interpolation</span>
<span class="w">   </span><span class="kt">character</span><span class="p">(</span><span class="n">SHR_KIND_CL</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">calendar</span><span class="w">          </span><span class="c">! stream calendar</span>
<span class="k">end type </span><span class="n">shr_stream_streamType</span>
</pre></div>
</div>
<p>Finally, the <code class="docutils literal notranslate"><span class="pre">shr_strdata_type</span></code> is the heart of the CIME data
model implemenentation and contains information for all the streams
that are active for the target data model. The first part of the
<code class="docutils literal notranslate"><span class="pre">shr_strdata_type</span></code> is filled in by the namelist values read in from the
namelist group (see the <a class="reference internal" href="input-streams.html#shr-strdata-nml"><span class="std std-ref">stream data namelist section</span></a>).</p>
<div class="highlight-Fortran notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="k">type </span><span class="n">shr_strdata_type</span>
<span class="w">   </span><span class="c">! --- set by input namelist ---</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">dataMode</span><span class="w">          </span><span class="c">! flags physics options wrt input data</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">domainFile</span><span class="w">        </span><span class="c">! file   containing domain info</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">streams</span><span class="w"> </span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w"> </span><span class="c">! stream description file names</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">taxMode</span><span class="w"> </span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w"> </span><span class="c">! time axis cycling mode</span>
<span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="n">R8</span><span class="p">)</span><span class="w">       </span><span class="kd">::</span><span class="w"> </span><span class="n">dtlimit</span><span class="w"> </span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w"> </span><span class="c">! dt max/min limit</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">vectors</span><span class="w"> </span><span class="p">(</span><span class="n">nVecMax</span><span class="p">)</span><span class="w"> </span><span class="c">! define vectors to vector map</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">fillalgo</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w"> </span><span class="c">! fill algorithm</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">fillmask</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w"> </span><span class="c">! fill mask</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">fillread</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w"> </span><span class="c">! fill mapping file to read</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">fillwrit</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w"> </span><span class="c">! fill mapping file to write</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">mapalgo</span><span class="w"> </span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w"> </span><span class="c">! scalar map algorithm</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">mapmask</span><span class="w"> </span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w"> </span><span class="c">! scalar map mask</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">mapread</span><span class="w"> </span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w"> </span><span class="c">! regrid mapping file to read</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">mapwrit</span><span class="w"> </span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w"> </span><span class="c">! regrid mapping file to write</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">tintalgo</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w"> </span><span class="c">! time interpolation algorithm</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">io_type</span><span class="w">           </span><span class="c">! io type, currently pnetcdf or netcdf</span>

<span class="w">  </span><span class="c">!--- data required by cosz t-interp method, ---</span>
<span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="n">R8</span><span class="p">)</span><span class="w">     </span><span class="kd">::</span><span class="w"> </span><span class="n">eccen</span><span class="w">   </span><span class="c">! orbital eccentricity</span>
<span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="n">R8</span><span class="p">)</span><span class="w">     </span><span class="kd">::</span><span class="w"> </span><span class="n">mvelpp</span><span class="w">  </span><span class="c">! moving vernal equinox long</span>
<span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="n">R8</span><span class="p">)</span><span class="w">     </span><span class="kd">::</span><span class="w"> </span><span class="n">lambm0</span><span class="w">  </span><span class="c">! mean long of perihelion at vernal equinox (radians)</span>
<span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="n">R8</span><span class="p">)</span><span class="w">     </span><span class="kd">::</span><span class="w"> </span><span class="n">obliqr</span><span class="w">  </span><span class="c">! obliquity in degrees</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">modeldt</span><span class="w"> </span><span class="c">! data model dt in seconds (set to the coupling frequency)</span>

<span class="w">  </span><span class="c">! --- data model grid, public ---</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">     </span><span class="kd">::</span><span class="w"> </span><span class="n">nxg</span><span class="w">          </span><span class="c">! data model grid lon size</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">     </span><span class="kd">::</span><span class="w"> </span><span class="n">nyg</span><span class="w">          </span><span class="c">! data model grid lat size</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">     </span><span class="kd">::</span><span class="w"> </span><span class="n">nzg</span><span class="w">          </span><span class="c">! data model grid vertical size</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">     </span><span class="kd">::</span><span class="w"> </span><span class="n">lsize</span><span class="w">        </span><span class="c">! data model grid local size</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">mct_gsmap</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">gsmap</span><span class="w">        </span><span class="c">! data model grid global seg map</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">mct_ggrid</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">grid</span><span class="w">         </span><span class="c">! data model grid ggrid</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">mct_avect</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">avs</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w"> </span><span class="c">! data model stream attribute vectors</span>

<span class="w">  </span><span class="c">! --- stream specific arrays, stream grid ---</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">shr_stream_streamType</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">stream</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">iosystem_desc_t</span><span class="p">),</span><span class="w"> </span><span class="k">pointer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">pio_subsystem</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">null</span><span class="p">()</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">io_desc_t</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">pio_iodesc</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">        </span><span class="kd">::</span><span class="w"> </span><span class="n">nstreams</span><span class="w">          </span><span class="c">! actual number of streams</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">        </span><span class="kd">::</span><span class="w"> </span><span class="n">strnxg</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">   </span><span class="c">! stream grid lon sizes</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">        </span><span class="kd">::</span><span class="w"> </span><span class="n">strnyg</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">   </span><span class="c">! stream grid lat sizes</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">        </span><span class="kd">::</span><span class="w"> </span><span class="n">strnzg</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">   </span><span class="c">! tream grid global sizes</span>
<span class="w">  </span><span class="kt">logical</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">dofill</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">   </span><span class="c">! true if stream grid is different from data model grid</span>
<span class="w">  </span><span class="kt">logical</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">domaps</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">   </span><span class="c">! true if stream grid is different from data model grid</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">        </span><span class="kd">::</span><span class="w"> </span><span class="n">lsizeR</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">   </span><span class="c">! stream local size of gsmapR on processor</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">mct_gsmap</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">gsmapR</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">   </span><span class="c">! stream global seg map</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">mct_rearr</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">rearrR</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">   </span><span class="c">! rearranger</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">mct_ggrid</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">gridR</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">    </span><span class="c">! local stream grid on processor</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">mct_avect</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">avRLB</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">    </span><span class="c">! Read attrvect</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">mct_avect</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">avRUB</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">    </span><span class="c">! Read attrvect</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">mct_avect</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">avFUB</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">    </span><span class="c">! Final attrvect</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">mct_avect</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">avFLB</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">    </span><span class="c">! Final attrvect</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">mct_avect</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">avCoszen</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w"> </span><span class="c">! data assocaited with coszen time interp</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">mct_sMatP</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">sMatPf</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">   </span><span class="c">! sparse matrix map for fill on stream grid</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">mct_sMatP</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">sMatPs</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">   </span><span class="c">! sparse matrix map for mapping from stream to data model grid</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">        </span><span class="kd">::</span><span class="w"> </span><span class="n">ymdLB</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">    </span><span class="c">! lower bound time for stream</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">        </span><span class="kd">::</span><span class="w"> </span><span class="n">todLB</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">    </span><span class="c">! lower bound time for stream</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">        </span><span class="kd">::</span><span class="w"> </span><span class="n">ymdUB</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">    </span><span class="c">! upper bound time for stream</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">        </span><span class="kd">::</span><span class="w"> </span><span class="n">todUB</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span><span class="w">    </span><span class="c">! upper bound time for stream</span>
<span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="n">R8</span><span class="p">)</span><span class="w">           </span><span class="kd">::</span><span class="w"> </span><span class="n">dtmin</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span>
<span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="n">R8</span><span class="p">)</span><span class="w">           </span><span class="kd">::</span><span class="w"> </span><span class="n">dtmax</span><span class="p">(</span><span class="n">nStrMax</span><span class="p">)</span>

<span class="w">  </span><span class="c">! --- internal ---</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">        </span><span class="kd">::</span><span class="w"> </span><span class="n">ymd</span><span class="w">  </span><span class="p">,</span><span class="n">tod</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">      </span><span class="kd">::</span><span class="w"> </span><span class="n">calendar</span><span class="w">          </span><span class="c">! model calendar for ymd,tod</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">        </span><span class="kd">::</span><span class="w"> </span><span class="n">nvectors</span><span class="w">          </span><span class="c">! number of vectors</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">        </span><span class="kd">::</span><span class="w"> </span><span class="n">ustrm</span><span class="w"> </span><span class="p">(</span><span class="n">nVecMax</span><span class="p">)</span>
<span class="w">  </span><span class="kt">integer</span><span class="p">(</span><span class="n">IN</span><span class="p">)</span><span class="w">        </span><span class="kd">::</span><span class="w"> </span><span class="n">vstrm</span><span class="w"> </span><span class="p">(</span><span class="n">nVecMax</span><span class="p">)</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="n">CL</span><span class="p">)</span><span class="w">      </span><span class="kd">::</span><span class="w"> </span><span class="n">allocstring</span>
<span class="k">end type </span><span class="n">shr_strdata_type</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="input-streams.html" class="btn btn-neutral float-left" title="3. Input Streams" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="data-model-science.html" class="btn btn-neutral float-right" title="5. Data Model Science" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, U.S. National Science Foundation and U.S. Department of Energy.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
     
<script>var version_json_loc = "../../../versions.json";</script>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>